<!DOCTYPE html>
<html>
    <head>
        <style>
            [data-open]
            {
                position:relative;
                display:block;
                width:300px;
                height:300px;
                background:red;
                padding:10px;
                transition:width 1s, height 2s;
            }
            [data-open='true']
            {
                width:600px;
                height:100px;
            }
            [data-bind='']
            {
                border:2px solid black;
            }
        </style>
    </head>
    <body>

        <div>
            <button id="button1">Toggle</button>
            <div id="menu1" data-open="false" data-bind>
                <button id="button2">Toggle</button>
                <div id="menu2" data-open="false" data-bind></div>
            </div>
        </div>

        <script>
            function TransitionDone(inElement, inHandlerStart, inHandlerStop)
            {
                var attrKey = "data-bind";
                var attrValue = "";

                var handleRun = function(inEvent)
                {
                    var t;
                    var keys;
                    t = inEvent.target;
                    keys = t.getAttribute(attrKey);
                    if(keys === null){return;}
                    if(keys == attrValue)
                    {
                        keys = {};
                        inHandlerStart(t);
                    }
                    else
                    {
                        keys = JSON.parse(keys);
                    }

                    if(keys[inEvent.propertyName]){return;}
                    keys[inEvent.propertyName] = true;
                    t.setAttribute(attrKey, JSON.stringify(keys));
                };
                var handleEnd = function(inEvent)
                {
                    var t;
                    var keys;
                    t = inEvent.target;
                    keys = t.getAttribute(attrKey);
                    if(keys === null){return;}
                    keys = JSON.parse(keys);

                    keys[inEvent.propertyName] = false;
                    for(var key in keys)
                    {
                        if(keys[key] == true)
                        {
                            t.setAttribute(attrKey, JSON.stringify(keys));
                            return;
                        }
                    }
                    t.setAttribute(attrKey, attrValue);
                    inHandlerStop(t);
                };

                inElement.addEventListener("transitionrun", handleRun);
                inElement.addEventListener("transitionend", handleEnd);
            }
        </script>
        <script>

            var toggle = function(inElement, inAttribute)
            {
                value = inElement.getAttribute(inAttribute)=="true";
                inElement.setAttribute( inAttribute, !value );
            };

            var pair = function(inSelButton, inSelMenu)
            {
                document.querySelector(inSelButton).addEventListener("click", function()
                {
                    toggle(document.querySelector(inSelMenu), "data-open");
                });
            };
            

            pair("#button1", "#menu1");
            pair("#button2", "#menu2");

            TransitionDone(document.body, e=>console.log("start"), e=>console.log("stop"));
            
        </script>

    </body>
</html>