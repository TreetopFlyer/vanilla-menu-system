<!DOCTYPE html>
<html>
    <head>
        <style>
            [data-open]
            {
                position:relative;
                display:block;
                width:300px;
                height:300px;
                background:red;
                padding:10px;
                transition:width 1s, height 2s;
            }
            [data-open='true']
            {
                width:600px;
                height:100px;
            }
            [data-bind='']
            {
                border:2px solid black;
            }
        </style>
    </head>
    <body>

        <div>
            <button id="button1">Toggle</button>
            <div id="menu1" data-open="false" data-bind>
                <button id="button2">Toggle</button>
                <div id="menu2" data-open="false" data-bind></div>
            </div>
        </div>

        <script>
            function TransitionDone(inElement)
            {
                var attrKey = "data-bind";
                var attrValue = "";

                var handleRun = function(inEvent)
                {
                    var keys;
                    keys = inEvent.target.getAttribute(attrKey);
                    if(keys === null){return;}
                
                    keys = (keys==attrValue) ? {} : JSON.parse(keys);
                    if(keys[inEvent.propertyName]){return;}

                    keys[inEvent.propertyName] = true;
                    inEvent.target.setAttribute(attrKey, JSON.stringify(keys));
                    console.log("start", keys);
                };
                var handleEnd = function(inEvent)
                {
                    var keys;
                    keys = inEvent.target.getAttribute(attrKey);
                    if(keys === null){return;}
                    
                    keys = (keys==attrValue) ? {} : JSON.parse(keys);
                    keys[inEvent.propertyName] = false;
                    
                    for(var key in keys)
                    {
                        if(keys[key] == true)
                        {
                            inEvent.target.setAttribute(attrKey, JSON.stringify(keys));
                            return;
                        }
                    }
                    inEvent.target.setAttribute(attrKey, attrValue);
                    console.log("stop", keys);
                };

                inElement.addEventListener("transitionrun", handleRun);
                inElement.addEventListener("transitionend", handleEnd);
            }
        </script>
        <script>

            var toggle = function(inElement, inAttribute)
            {
                value = inElement.getAttribute(inAttribute)=="true";
                inElement.setAttribute( inAttribute, !value );
            };

            var button, menu;
            button = document.querySelector("#button1");
            menu = document.querySelector("#menu1");

            button.addEventListener("click", function(e)
            {
                toggle(menu, "data-open");
            }
            );

            TransitionDone(document.body);
            
        </script>

    </body>
</html>