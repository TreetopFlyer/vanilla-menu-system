<!DOCTYPE html>
<html>
    <head>
        <script>
function channel(inAttrGet, inAttrSet, inIterator)
{
    itr = inIterator || function(){};
    function update(inElement)
    {
        var kvp, members, i;
        kvp = inElement.getAttribute(inAttrSet);
        if(!kvp){ return; }else{ kvp = kvp.split(":"); }
        members = document.querySelectorAll("["+inAttrGet+"^='"+kvp[0]+"']");
        if(kvp[1] == "null" && members.length){ kvp[1] = !(members[0].getAttribute(inAttrGet).split(":")[1] == "true"); }
        for(i=0; i<members.length; i++){ members[i].setAttribute(inAttrGet, kvp[0]+":"+kvp[1]); itr(members[i], kvp[0], kvp[1]); }
    }
    function handler(inEvent)
    {
        for(var i=0; i<inEvent.path.length-3; i++){ update(inEvent.path[i]); }
    }
    document.addEventListener("click", handler);
    return function(){document.removeEventListener("click", handler);}
}


function UpdateAndBlend(inElement, inAttributeOpen, inMode, inHandler)
{
    var attrCache, interrupt, expand, live, heightStart, heightFuture, heightTime;
    attrCache = "data-transition-cache";
    interrupt = inElement.getAttribute(attrCache);
    expand = !(inElement.getAttribute(inAttributeOpen) == "true");
    if(inMode == !expand){ return; } // quit if there's no state change
    if(interrupt)
    {
        inElement.style.height = expand ? interrupt.split("|")[1] : interrupt.split("|")[0];
        inElement.setAttribute(inAttributeOpen, expand);
    }
    else
    {
        live = getComputedStyle(inElement);
        heightStart = live.height;
        inElement.setAttribute(inAttributeOpen, expand);
        heightFuture = live.height;
        heightTime = live.transition;
        inElement.setAttribute(inAttributeOpen, !expand);
        inElement.clientHeight; // this property access is necessary to prevent instant collapse (not sure why)
        if(heightStart == heightFuture){ return; } // quit if there's no spatial change
        inElement.setAttribute(inAttributeOpen, expand);
        if(heightTime.substring(0, 7) == "none 0s" || heightTime.substring(0, 6) == "all 0s" || heightTime.indexOf("height 0s") != -1){ return; } // quit if there's no temporal change
        inElement.style.height = heightStart;
        inElement.addEventListener("transitionend", done);
        inElement.setAttribute(attrCache, expand ? heightStart+"|"+heightFuture : heightFuture+"|"+heightStart);
        setTimeout(function(){ inElement.style.height = heightFuture; });
    }
    function done(inEvent)
    {
        if(inEvent.target != inEvent.srcElement || inEvent.propertyName != "height"){ return; }
        inEvent.target.removeEventListener("transitionend", done);
        inEvent.target.removeAttribute(attrCache);
        inElement.style.height = "";
    }
}

        </script>
    </head>

    <body>
<style>
    [data-get], [data-invert][data-get$='true']
    {
        display:none;
    }
    [data-get$='true'], [data-invert][data-get$='false']
    {
        display:block;
    }

    .collapse
    {
        display:block;
        height:0;
        background:salmon;
        overflow:hidden;
        transition:height 0.5s;
    }
    .collapse[data-open='true']
    {
        display:block;
        height:auto;

    }
</style>
<script>
    var unbind = channel("data-get", "data-set", function(inElement, inKey, inValue)
    {
        UpdateAndBlend(inElement, "data-open", inValue);
    });
</script>
<div>
    <button data-set="menu1:null">
        <span data-get="menu1" data-invert>On</span>
        <span data-get="menu1">Off</span>
    </button>
    <div class="collapse" data-get="menu1">
        menu
    </div>
</div>

    </body>
</html>